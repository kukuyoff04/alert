# ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå: .github/workflows/water_alert.yml

name: üåä Inburi Water Level Alert

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  scrape-and-notify:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Check out repository
        uses: actions/checkout@v4

      - name: 2. Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 3. Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: 4. Install Playwright browser
        run: playwright install --with-deps chromium

      - name: 5. Run scraper script
        env:
          LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
        run: python scrape_water.py
      
      # --- ‚¨áÔ∏è ‡πÄ‡∏û‡∏¥‡πà‡∏° Step ‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà ‚¨áÔ∏è ---
      - name: 6. Upload Debug Screenshot on Failure
        # 'if: failure()' ‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤ step ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô '‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠' step ‡∏ó‡∏µ‡πà 5 ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: debug-screenshot # ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
          path: debug_screenshot.png # ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå python ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
          retention-days: 5 # ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏ß‡πâ 5 ‡∏ß‡∏±‡∏ô
